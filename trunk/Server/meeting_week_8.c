/* Meeting notes week 8
 * 
 * Copyright 2010 Adrien BÃ©raud <dan.aladine@gmail.com>
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *              http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * 
 */


/*location of API and examples:
*[project folder]/Microblaze0/include/xparameters.h
*file:///D:/Xilinx/12.1/ISE_DS/EDK/sw/XilinxProcessorIPLib/drivers/(x)/doc/html/api/
*Where (x) is the PI unit name which you wanna get reference document. 
*/

//Struct

struct ball_msg {
  
  int dir,speed,x,y;
};

struct player_msg {
  
  int id,x,y;
};


//Physical rules:

boolean possess_ball(player,ball){
	if distance(player,ball)<11
	return true;
	else return false;
}

boolean in_border(int x, int y){
	if(x>20) && (x<620) && (y>40) && (y<440) && (x+y>80) && (x+y<600+440) && (620-x+y-40>20) && (620-x+440-y>20) && (x-20+440-y<20) return true;
	return false;
}

float distance(player,ball){
	return sqrt((player.x-ball.x)^2+ (player.y-ball.y)^2);
}

int check_contact(&player,&ball){
	if(player.x=player.y=0){
		ball.dir=ball.dir+8;
	}else{
		ball.speed=2*player.speed;
		ball.dir=player.dir;
	}
}

void new_vel_ball(&ball){
	if(ball.speed>0)
	ball.speed=ball.speed-10;
}


//Position(x:10bits  y:10bits)
from (20,40) to (620, 440)
//DIP switch

//Timer

//Extention
Priority queue?
using dip, push button to swich strategy

//Initialize position value
controller->ball:  players: predefined value
then
server->controller: ball-random value

//Game_state: server
refree
check physical rules: if controller team sends wrong position-->foul
Starting-Ending: using timer.
display: football field.

//Strategy

//Questions
Can players speed up continuously?
When the match begins, 
contact with field border: can teh ball/players overlap on the line.


Server will wait for 2 teams send the data first then generate the ball positions.

//Communication between threads in one microblaze: msg queue
//inter process Communication between 2 microblazes: mailbox

//Tips for debugging
Using Bram or DDRAM
When using DDRAM, you can change the heap size to 0x400(right click on project, generate linker script)
Switch from DDRAM to BRAM: Right click on project/ Get compiler options, then choose default linker scripts
In case both 2 micoblazes running on DDRAM, some overlap memories may occur and you need to specify their base address and length in file linker script(...).For example, you can say half of the DDRAM for microblaze 0, the second half is for microblaze 1.
Check program size: Go to software/ Get program size
Optimize the size of program:  Right click on project/ Get compiler options/ Optimize


//We can store in 2 files in one software project.
	//data.c
char data[] __attribute__ ((aligned (4))) = {
0x0,0x9,0xf,0xf0,0xf,0xf0,0xf,0xf0,0xf,0xf0,0x0,0x0,0x1,0x61,0x0,0xb,0x73,0x79,0x73,0x74,0x65,0x6d,0x2e,0x6e,0x63,0x64,0x0,0x62,0x0,0xc,0x34,0x76,0x73,0x78,0x33,0x35,0x66,0x66,0x36,0x36,0x38,0x0,0x63,0x0,0xb,0x32,0x30,0x30,0x37,0x2f,0x20,0x34,0x2f,0x20,0x32,0x0,0x64,0x0,0x9,0x31,0x34,0x3a,0x33,0x34,0x3a,0x33,0x37,0x0,0x65,0x0,0x1a,0x21,0x98,0xff,0xff,0xff,0xff,0xaa,0x99,0x55,0x66,0x20,0x0,0x0,0x0,0x30,0x0,0x80,0x1,0x0,0x0,0x0,0x7,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x30,0x1,0x20,0x1,0x0,0x5,0x31,0xe5,0x30,0x1,0x80,0x1,0x2,0x8,0x80,0x93,0x30,0x0,0x80,0x1,0x0,0x0,0x0,0x9,0x20,0x0,0x0,0x0,0x30,0x0,0xc0,0x1,0x0,0x0,0x6,0x0,0x30,0x0,0xa0,0x1,0x0,0x0,0x6,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0,0x0,0x20,0x0,0x0
};
	//main program
extern char data[];
char *sendmsg = data;


